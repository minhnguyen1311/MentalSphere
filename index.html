<html>
  <head>
    <style>
      html, body { 
        background-color:#000;
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden !important;  
      }
    </style>
    
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@latest/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@latest/examples/jsm/"
      }
    }
    </script>

    <script type="module">

      import * as THREE from 'three';
      import { OrbitControls } from 'three/addons/controls/OrbitControls.js';      

      var renderer, controls, scene, camera;

      window.onload = function() {

        // Creates a container for all obj, lights, and cameras in the 3D environment.
        scene = new THREE.Scene();

        // setup the camera
        var fov = 75;
        var ratio = window.innerWidth / window.innerHeight;
        var zNear = 1;
        var zFar = 10000;
        camera = new THREE.PerspectiveCamera( fov, ratio, zNear, zFar );
        camera.position.set(0, 0, 100);

        // create renderer and setup the canvas
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        // Add a sphere (globe)
        const geometry = new THREE.SphereGeometry( 40, 32, 32 );
        const textureLoader = new THREE.TextureLoader(); // Loads a world map texture to wrap around the sphere.
        const globeTexture = textureLoader.load('earth.jpg'); // The earth image must be 2:1 ratio to wrap around
        const material = new THREE.MeshBasicMaterial({ map: globeTexture });
        const globe = new THREE.Mesh( geometry, material );
        scene.add(globe);
 
        // Set up the orbit controls (mouse interaction)
        controls = new OrbitControls( camera, renderer.domElement ); 
        controls.enableDamping = true; // Smooth camera movements
        controls.enablePan = false; // Disable panning with the right mouse click

        // Add depressive disorder data
        const depressiveData = [
            { country: "Uganda", rate: 7.80, lat: 1.3733, lon: 32.2903 },
            { country: "Greenland", rate: 7.70, lat: 71.7069, lon: -42.6043 },
            { country: "Lesotho", rate: 7.40, lat: -29.6091, lon: 28.2336 },
            { country: "Palestine", rate: 7.30, lat: 31.9522, lon: 35.2332 },
            { country: "Angola", rate: 6.80, lat: -11.2027, lon: 17.8739 },
            { country: "Tunisia", rate: 6.80, lat: 33.8869, lon: 9.5375 },
            { country: "Central African Republic", rate: 6.70, lat: 6.6111, lon: 20.9394 },
            { country: "Gabon", rate: 6.70, lat: -0.8037, lon: 11.6094 },
            { country: "Equatorial Guinea", rate: 6.60, lat: 1.6500, lon: 10.2674 },
            { country: "Congo", rate: 6.50, lat: -4.0383, lon: 21.7587 },
            { country: "Gambia", rate: 6.30, lat: 13.4432, lon: -15.3100 },
            { country: "Greece", rate: 6.30, lat: 39.0742, lon: 21.8243 },
            { country: "Lebanon", rate: 6.20, lat: 33.8547, lon: 35.8623 },
            { country: "Democratic Republic of Congo", rate: 6.10, lat: -4.0383, lon: 21.7587 },
            { country: "Nepal", rate: 6.10, lat: 28.3949, lon: 84.1240 },
            { country: "Eswatini", rate: 6.00, lat: -26.5225, lon: 31.4659 },
            { country: "Guyana", rate: 6.00, lat: 4.8604, lon: -58.9302 },
            { country: "Morocco", rate: 6.00, lat: 31.7917, lon: -7.0926 },
            { country: "Afghanistan", rate: 5.90, lat: 33.93911, lon: 67.709953 },
            { country: "Cape Verde", rate: 5.80, lat: 16.5388, lon: -23.0418 },
            { country: "Mozambique", rate: 5.80, lat: -18.6657, lon: 35.5296 },
            { country: "Portugal", rate: 5.80, lat: 39.3999, lon: -8.2245 },
            { country: "Rwanda", rate: 5.80, lat: -1.9403, lon: 29.8739 },
            { country: "Somalia", rate: 5.80, lat: 5.1521, lon: 46.1996 },
            { country: "Suriname", rate: 5.80, lat: 3.9193, lon: -56.0278 },
            { country: "Chad", rate: 5.60, lat: 15.4542, lon: 18.7322 },
            { country: "Iran", rate: 5.60, lat: 32.4279, lon: 53.6880 },
            { country: "Spain", rate: 5.50, lat: 40.4637, lon: -3.7492 },
            { country: "United States", rate: 5.50, lat: 37.0902, lon: -95.7129 },
            { country: "Bangladesh", rate: 5.40, lat: 23.685, lon: 90.3563 },
            { country: "Burundi", rate: 5.40, lat: -3.3731, lon: 29.9189 },
            { country: "Eritrea", rate: 5.40, lat: 15.1794, lon: 39.7823 },
            { country: "Kenya", rate: 5.40, lat: -1.2921, lon: 36.8219 },
            { country: "Lithuania", rate: 5.40, lat: 55.1694, lon: 23.8813 },
            { country: "Madagascar", rate: 5.40, lat: -18.7669, lon: 46.8691 },
            { country: "Bahrain", rate: 5.30, lat: 25.9304, lon: 50.6378 },
            { country: "Botswana", rate: 5.30, lat: -22.3285, lon: 24.6849 },
            { country: "Ethiopia", rate: 5.30, lat: 9.145, lon: 40.4897 },
            { country: "South Africa", rate: 5.30, lat: -30.5595, lon: 22.9375 },
            { country: "Belarus", rate: 5.20, lat: 53.9, lon: 27.5667 },
            { country: "Finland", rate: 5.20, lat: 61.9241, lon: 25.7482 },
            { country: "Ireland", rate: 5.20, lat: 53.1424, lon: -7.6921 },
            { country: "San Marino", rate: 5.20, lat: 43.9333, lon: 12.45 },
            { country: "South Sudan", rate: 5.20, lat: 6.8769, lon: 31.3069 },
            { country: "Tanzania", rate: 5.20, lat: -6.369028, lon: 34.8888 },
            { country: "United Kingdom", rate: 5.20, lat: 55.3781, lon: -3.4360 },
            { country: "Yemen", rate: 5.20, lat: 15.5529, lon: 48.5164 },
            { country: "Monaco", rate: 5.10, lat: 43.7333, lon: 7.4167 },
            { country: "Sweden", rate: 5.10, lat: 60.1282, lon: 18.6435 },
            { country: "Cameroon", rate: 5.00, lat: 3.8480, lon: 11.5021 }
        ];

        // Function to convert latitude/longitude to 3D coordinates
        function latLongToVector3(lat, lon, radius) {
          const phi = (90 - lat) * (Math.PI / 180);
          const theta = (lon + 180) * (Math.PI / 180);
          const x = -(radius * Math.sin(phi) * Math.cos(theta));
          const y = radius * Math.cos(phi);
          const z = radius * Math.sin(phi) * Math.sin(theta);
          return new THREE.Vector3(x, y, z);
        }

        // Add data points (markers) to the globe based on depressive rates
        function addDepressiveMarkers() {
          depressiveData.forEach(point => {
            let { country, rate, lat, lon } = point;
            let position = latLongToVector3(lat, lon, 40); // 40 radius for positioning
            let size = (rate / 10) * 2; // Scale size of marker based on rate
            let color = new THREE.Color(rate / 10, 1 - rate / 10, 0); // Set color from green to red (depends on state)

            // Create marker as a small sphere
            let sphere = new THREE.Mesh(
              new THREE.SphereGeometry(size, 8, 8),
              new THREE.MeshBasicMaterial({ color: color })
            );
            sphere.position.copy(position);
            scene.add(sphere);
          });
        }

        // Load the markers and start animation
        addDepressiveMarkers();

        // call animation/rendering loop
        animate();
        
      };

      function animate() {

        requestAnimationFrame( animate ); // Create a smooth animation loop
        controls.update(); // Update controls for interaction (rotate, zoom, pan)
        renderer.render(scene, camera); // Render the scene
        
      };
    </script>
  </head>
  <body></body>
</html>